# CLI Command Contracts: Core CLI Todo Application

**Feature**: 001-core-todo-cli
**Date**: 2025-12-26
**Purpose**: Define CLI command interfaces, arguments, outputs, and error responses

## Overview

The Core CLI Todo Application exposes 6 primary commands through a CLI interface using Python's argparse module. All commands follow standard UNIX conventions for exit codes (0 = success, 1 = error) and error reporting (stderr for errors).

## Execution Entry Point

```bash
python -m src.cli.main <command> [arguments] [options]
```

**Global Options**:
- `--help, -h`: Show help message and exit (auto-generated by argparse)

**Version**: Not implemented in Phase I (can add `--version` in Phase II)

---

## Command Reference

### 1. add - Create New Task

**Purpose**: Add a new task with required title and optional description

**Syntax**:
```bash
python -m src.cli.main add <title> [--description <text>]
```

**Arguments**:
- `title` (positional, required): Task title as a string
  - Must be non-empty
  - May contain spaces (use quotes: "My Title")
  - Recommended max 200 characters for display

**Options**:
- `--description <text>` (optional): Additional task details
  - Default: empty string
  - May be any length
  - Use quotes for multi-word descriptions

**Success Output** (stdout):
```
Task #<id> added: <title>
```

**Error Output** (stderr):
```
Error: Title is required
```

**Exit Codes**:
- `0`: Task added successfully
- `1`: Validation error (empty title)

**Examples**:
```bash
# Basic usage
$ python -m src.cli.main add "Buy groceries"
Task #1 added: Buy groceries

# With description
$ python -m src.cli.main add "Write report" --description "Quarterly summary"
Task #2 added: Write report

# Error case (empty title)
$ python -m src.cli.main add ""
Error: Title is required
```

---

### 2. list - View All Tasks

**Purpose**: Display all tasks with ID, title, and completion status

**Syntax**:
```bash
python -m src.cli.main list
```

**Arguments**: None

**Options**: None (Phase I shows all tasks; filtering deferred to Phase II)

**Success Output** (stdout):
```
ID    Title                          Status
---------------------------------------------
1     Buy groceries                  pending
2     Write report                   ✓ completed
3     Call dentist                   pending
```

**Empty List Output** (stdout):
```
No tasks found.
```

**Exit Codes**:
- `0`: Always succeeds (empty list is valid)

**Display Rules**:
- Column widths: ID (5 chars), Title (30 chars), Status (15 chars)
- Long titles truncated with ellipsis: "Very long title that exceeds..."
- Completed status shown as "✓ completed" for clarity
- Pending status shown as "pending"
- Tasks displayed in insertion order (ID ascending)

**Examples**:
```bash
# List with tasks
$ python -m src.cli.main list
ID    Title                          Status
---------------------------------------------
1     Buy groceries                  pending
2     Write report                   ✓ completed

# Empty list
$ python -m src.cli.main list
No tasks found.
```

---

### 3. update - Modify Task Details

**Purpose**: Update an existing task's title and/or description

**Syntax**:
```bash
python -m src.cli.main update <id> [--title <text>] [--description <text>]
```

**Arguments**:
- `id` (positional, required): Task ID as an integer
  - Must be positive integer
  - Must exist in storage

**Options** (at least one required):
- `--title <text>`: New task title
  - Must be non-empty if provided
  - Replaces existing title
- `--description <text>`: New task description
  - May be empty string (clears description)
  - Replaces existing description

**Success Output** (stdout):
```
Task #<id> updated.
```

**Error Output** (stderr):
```
Error: Task not found with ID <id>
Error: Title cannot be empty
Error: At least one of --title or --description must be provided
```

**Exit Codes**:
- `0`: Task updated successfully
- `1`: Task not found, validation error, or no options provided

**Examples**:
```bash
# Update title only
$ python -m src.cli.main update 1 --title "Buy groceries and medicine"
Task #1 updated.

# Update description only
$ python -m src.cli.main update 2 --description "Annual summary due Friday"
Task #2 updated.

# Update both
$ python -m src.cli.main update 3 --title "Schedule appointment" --description "Call by EOD"
Task #3 updated.

# Error case (task not found)
$ python -m src.cli.main update 99 --title "New title"
Error: Task not found with ID 99

# Error case (empty title)
$ python -m src.cli.main update 1 --title ""
Error: Title cannot be empty
```

---

### 4. delete - Remove Task

**Purpose**: Delete a task by ID

**Syntax**:
```bash
python -m src.cli.main delete <id>
```

**Arguments**:
- `id` (positional, required): Task ID as an integer
  - Must be positive integer
  - Must exist in storage

**Options**: None

**Success Output** (stdout):
```
Task #<id> deleted.
```

**Error Output** (stderr):
```
Error: Task not found with ID <id>
```

**Exit Codes**:
- `0`: Task deleted successfully
- `1`: Task not found

**Notes**:
- Deletion is permanent (no undo in Phase I)
- Deleted task IDs are never reused
- No confirmation prompt (user must be intentional)

**Examples**:
```bash
# Successful delete
$ python -m src.cli.main delete 1
Task #1 deleted.

# Error case (task not found)
$ python -m src.cli.main delete 99
Error: Task not found with ID 99
```

---

### 5. complete - Mark Task as Completed

**Purpose**: Mark a task as completed

**Syntax**:
```bash
python -m src.cli.main complete <id>
```

**Arguments**:
- `id` (positional, required): Task ID as an integer
  - Must be positive integer
  - Must exist in storage

**Options**: None

**Success Output** (stdout):
```
Task #<id> marked as completed.
```

**Error Output** (stderr):
```
Error: Task not found with ID <id>
```

**Exit Codes**:
- `0`: Task marked as completed
- `1`: Task not found

**Notes**:
- Idempotent: Calling `complete` on already completed task succeeds (no error)
- Status change visible immediately in `list` command

**Examples**:
```bash
# Mark as completed
$ python -m src.cli.main complete 1
Task #1 marked as completed.

# Verify status
$ python -m src.cli.main list
ID    Title                          Status
---------------------------------------------
1     Buy groceries                  ✓ completed

# Error case (task not found)
$ python -m src.cli.main complete 99
Error: Task not found with ID 99
```

---

### 6. incomplete - Mark Task as Pending

**Purpose**: Mark a task as incomplete/pending (toggle back from completed)

**Syntax**:
```bash
python -m src.cli.main incomplete <id>
```

**Arguments**:
- `id` (positional, required): Task ID as an integer
  - Must be positive integer
  - Must exist in storage

**Options**: None

**Success Output** (stdout):
```
Task #<id> marked as pending.
```

**Error Output** (stderr):
```
Error: Task not found with ID <id>
```

**Exit Codes**:
- `0`: Task marked as pending
- `1`: Task not found

**Notes**:
- Idempotent: Calling `incomplete` on already pending task succeeds (no error)
- Allows users to reopen completed tasks

**Examples**:
```bash
# Mark as pending
$ python -m src.cli.main incomplete 1
Task #1 marked as pending.

# Verify status
$ python -m src.cli.main list
ID    Title                          Status
---------------------------------------------
1     Buy groceries                  pending

# Error case (task not found)
$ python -m src.cli.main incomplete 99
Error: Task not found with ID 99
```

---

## Help System

### Main Help

```bash
$ python -m src.cli.main --help
usage: main.py [-h] {add,list,update,delete,complete,incomplete} ...

Core CLI Todo Application - Manage your tasks from the command line

positional arguments:
  {add,list,update,delete,complete,incomplete}
    add                 Add a new task
    list                List all tasks
    update              Update an existing task
    delete              Delete a task
    complete            Mark a task as completed
    incomplete          Mark a task as pending

optional arguments:
  -h, --help            show this help message and exit
```

### Command-Specific Help

```bash
$ python -m src.cli.main add --help
usage: main.py add [-h] [--description DESCRIPTION] title

positional arguments:
  title                 Task title (required)

optional arguments:
  -h, --help            show this help message and exit
  --description DESCRIPTION
                        Task description (optional)
```

---

## Error Handling Standards

### Error Message Format

All errors follow the format:
```
Error: <descriptive message>
```

### Common Errors

| Error Type | Message | Cause | User Action |
|-----------|---------|-------|-------------|
| Task Not Found | `Task not found with ID <id>` | Invalid task ID | Use `list` to see valid IDs |
| Empty Title | `Title is required` | No title provided or empty string | Provide non-empty title |
| Invalid Command | `invalid choice: '<cmd>'` (argparse) | Unknown command | Use `--help` to see valid commands |
| Missing Argument | `the following arguments are required: <arg>` (argparse) | Required argument missing | Check command help |

### Exit Code Convention

- `0`: Success (operation completed as expected)
- `1`: Error (validation failure, not found, or invalid input)

---

## Future Enhancements (Phase II/III)

### Filtering and Sorting

```bash
# Filter by status
python -m src.cli.main list --status pending
python -m src.cli.main list --status completed

# Sort by different fields
python -m src.cli.main list --sort title
python -m src.cli.main list --sort id --reverse

# Search by title
python -m src.cli.main list --search "groceries"
```

### Bulk Operations

```bash
# Complete multiple tasks
python -m src.cli.main complete 1 2 3

# Delete multiple tasks
python -m src.cli.main delete 1 2 3
```

### Export/Import

```bash
# Export to JSON
python -m src.cli.main export tasks.json

# Import from JSON
python -m src.cli.main import tasks.json
```

### Interactive Mode

```bash
# Launch interactive REPL
python -m src.cli.main interactive
```

---

## Command Implementation Mapping

### CLI → Service Layer Mapping

| CLI Command | Service Method | Service Args | Service Return |
|------------|----------------|--------------|----------------|
| `add <title> [--description]` | `add_task(title, description)` | `title: str, description: str = ""` | `Task` |
| `list` | `get_all_tasks()` | None | `List[Task]` |
| `update <id> [--title] [--description]` | `update_task(id, title, description)` | `task_id: int, title: Optional[str], description: Optional[str]` | `Task` |
| `delete <id>` | `delete_task(id)` | `task_id: int` | `bool` |
| `complete <id>` | `toggle_complete(id, True)` | `task_id: int, completed: bool` | `Task` |
| `incomplete <id>` | `toggle_complete(id, False)` | `task_id: int, completed: bool` | `Task` |

### Command Handler Pattern

```python
def handle_add(args, task_service):
    try:
        task = task_service.add_task(args.title, args.description or "")
        print(f"Task #{task.id} added: {task.title}")
        return 0
    except ValueError as e:
        print(f"Error: {e}", file=sys.stderr)
        return 1

def handle_list(args, task_service):
    tasks = task_service.get_all_tasks()
    if not tasks:
        print("No tasks found.")
        return 0

    print(f"{'ID':<5} {'Title':<30} {'Status':<15}")
    print("-" * 50)
    for task in tasks:
        status = "✓ completed" if task.completed else "pending"
        title = task.title[:30]  # Truncate if too long
        print(f"{task.id:<5} {title:<30} {status:<15}")
    return 0
```

---

## Testing Contract Compliance

### Manual Test Checklist

For each command, verify:
- ✓ Correct arguments accepted
- ✓ Required arguments enforced (argparse validation)
- ✓ Optional arguments work as expected
- ✓ Success output matches format
- ✓ Error output matches format
- ✓ Exit code 0 on success
- ✓ Exit code 1 on error
- ✓ Help text displays correctly

### Acceptance Test Examples

```bash
# Test add command contract
$ python -m src.cli.main add "Test Task"
Task #1 added: Test Task
$ echo $?  # Should print 0

# Test error contract
$ python -m src.cli.main delete 99
Error: Task not found with ID 99
$ echo $?  # Should print 1

# Test help contract
$ python -m src.cli.main --help
# Should display help text
$ echo $?  # Should print 0
```

---

## CLI Contract Sign-Off

All command interfaces, arguments, outputs, error responses, and exit codes documented. Command-to-service mappings defined. Ready to proceed to Quickstart Guide.

**Reviewer**: Claude Sonnet 4.5
**Date**: 2025-12-26
**Status**: ✅ Complete
